
@namespace BlazorFlowly.Components
@using Title = AntDesign.Charts.Title

<AntDesign.Charts.Column @ref="chart" Config="chartConfig" />

@code {
    [Parameter]
    public string Title { get; set; } = "";

    [Parameter]
    public string XFieldName { get; set; } = "";

    [Parameter]
    public string YFieldName { get; set; } = "";

    [Parameter]
    public Task<ChartDataItem[]> DataGetter { get; set; }

    private IChartComponent chart;
    private ColumnConfig chartConfig = new ColumnConfig{
       Title = new Title{
            Visible = false,
            Text = ""
        },
        XField = "x",
        YField = "y",
        Padding = "auto",
        ForceFit = true
    };

    protected override async Task OnInitializedAsync(){
        await base.OnInitializedAsync();

        var data = await DataGetter;
        if(data != null)
        {
            await chart.ChangeData(data);
        }   
    }

   protected override async Task OnParametersSetAsync(){
       await base.OnParametersSetAsync();

        //var data = await DataGetter;
        //await chart.ChangeData(data);

        if(Title != null){
            Title title = new Title{
                Visible = true,
                Text = Title
            };
            chartConfig.Title = title;
        }

        if ((XFieldName != null) && (YFieldName != null)){
            object Meta = new{
                X = new{
                    Alias = XFieldName
                },
                Y = new{
                    Alias = YFieldName
                }
            };
            chartConfig.Meta = Meta;
        }
       await chart.UpdateConfig(chartConfig);
   }
}
