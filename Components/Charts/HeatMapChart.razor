@namespace BlazorFlowly.Components
@using Title = AntDesign.Charts.Title

<AntDesign.Charts.Heatmap @ref="chart" Config="chartConfig" />

@code {
    [Parameter]
    public string Title { get; set; } = "";

	[Parameter]
    public Task<VisitorsDataItem[]> DataGetter { get; set; }
    private VisitorsDataItem[] data;

    private IChartComponent chart;
	private HeatmapConfig chartConfig = new HeatmapConfig{
        Title = new AntDesign.Charts.Title{
            Visible = false,
            Text = ""
        },
        Padding = "auto",
        ForceFit = true,
        XField = "x",
        YField = "visitor",
        ColorField = "y",
        Color = new[] { "#C5EAD4", "#F9E79F", "#F5CBA7", "#E6B0AA" },
        Meta = new{
            X = new{
                type = "cat"
            }
        }
    };

    protected override async Task OnInitializedAsync(){
        await base.OnInitializedAsync();

        data = await DataGetter;
        if(data != null)
        {
            await chart.ChangeData(data);
        } 
    }
    protected override async Task OnParametersSetAsync(){
        await base.OnParametersSetAsync();

        //var data = await DataGetter;
        //await chart.ChangeData(data);

        if (Title != null){
            Title title = new Title{
                Visible = true,
                Text = Title
            };
            chartConfig.Title = title;
        }
        await chart.UpdateConfig(chartConfig);
    }
}
